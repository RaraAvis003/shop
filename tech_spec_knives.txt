# ТЕХНИЧЕСКОЕ ЗАДАНИЕ
## Интернет-магазин ножей и топоров

---

## 1. ОБЩАЯ ИНФОРМАЦИЯ ПРОЕКТА

### 1.1 Описание проекта
Интернет-магазин авторских ножей и топоров ручной работы с возможностью покупки товаров "в наличии" и оформления заказов "под заказ".

### 1.2 Масштаб проекта
- **Количество товаров**: до 100 единиц
- **Ожидаемая нагрузка**: 10-100 заказов в день
- **Команда разработки**: 1 разработчик (solo dev)
- **Сроки**: MVP как можно раньше, но не критично

---

## 2. ТЕХНОЛОГИЧЕСКИЙ СТЕК

### 2.1 Backend
- Django 5.0
- Django REST Framework (DRF)
- PostgreSQL 15
- Redis 7
- MinIO (S3-совместимое хранилище)
- Celery + Redis
- Gunicorn
- Nginx
- ЮKassa API

### 2.2 Frontend
- Next.js 14 (App Router)
- TypeScript (опционально JavaScript)
- Tailwind CSS
- shadcn/ui
- lucide-react
- Swiper.js

---

## 3. СТРУКТУРА БАЗЫ ДАННЫХ

### 3.1 Product (Товар)
**Основные поля**:
- name, slug, description, price
- category (ForeignKey)

**Характеристики**:
- blade_length (длина клинка, мм)
- total_length (общая длина, мм)
- weight (вес, г)
- blade_thickness (толщина клинка, мм)
- blade_material (материал клинка)
- handle_material (материал рукояти)
- hardness (твердость HRC)
- specifications (JSONB для дополнительных характеристик)

**Статусы и флаги**:
- stock_status: in_stock, made_to_order, out_of_stock
- is_featured (для слайдера на главной)
- is_new (для секции "Новинки")

**Метрики**:
- views_count
- average_rating

**Временные метки**:
- created_at, updated_at

### 3.2 Category (Категория)
- name, slug
- parent (древовидная структура)
- icon_name
- order (сортировка)

### 3.3 ProductImage (Изображения)
- product (ForeignKey)
- image (ImageField)
- order (сортировка)
- is_main (главное фото)

**Ограничение**: до 8 изображений на товар

### 3.4 Order (Заказ)
**Клиент**:
- user (опционально для гостей)
- name, email, phone

**Доставка**:
- delivery_address
- delivery_method
- delivery_cost

**Оплата**:
- total_amount
- discount_amount
- promo_code

**Статусы**:
- pending (ожидает оплаты)
- paid (оплачен)
- processing (в обработке)
- shipped (отправлен)
- delivered (доставлен)
- made_to_order (под заказ, в производстве)
- cancelled (отменен)

### 3.5 OrderItem (Позиции заказа)
- order (ForeignKey)
- product (ForeignKey)
- quantity
- price (цена на момент заказа)

### 3.6 Payment (Платежи)
- order (ForeignKey)
- payment_id (ID от ЮKassa)
- idempotency_key (для идемпотентности)
- amount, currency
- status: pending, waiting_for_capture, succeeded, canceled, refunded
- metadata (JSONB с данными от ЮKassa)

### 3.7 Cart & CartItem (Корзина)
**Cart**:
- user (опционально)
- session_key (для гостей)

**CartItem**:
- cart (ForeignKey)
- product (ForeignKey)
- quantity
- reserved_until (для резервирования товаров в наличии)

### 3.8 Review (Отзывы)
- product (ForeignKey)
- user (ForeignKey)
- rating (1-5)
- title, text
- pros, cons (достоинства/недостатки)
- is_approved (модерация)
- is_verified_buyer (проверенная покупка)
- helpful_count (счетчик "Полезно")
- created_at

**Ограничение**: unique_together ['product', 'user']

### 3.9 ReviewImage
- review (ForeignKey)
- image (ImageField)
- order

**Ограничение**: до 5 фото на отзыв

### 3.10 ReviewHelpful
- review (ForeignKey)
- user (ForeignKey)

**Ограничение**: unique_together ['review', 'user']

### 3.11 WishlistItem (Избранное)
- user (ForeignKey)
- product (ForeignKey)
- added_at

**Ограничение**: unique_together ['user', 'product']

### 3.12 Promotion (Акции)
**Типы скидок**:
- percentage (процент)
- fixed (фиксированная сумма)
- free_shipping (бесплатная доставка)

**Основные поля**:
- title, slug, description
- discount_type, discount_value
- min_order_amount (минимальная сумма заказа)
- promo_code

**Период действия**:
- start_date, end_date

**Применение**:
- products (ManyToMany)
- categories (ManyToMany)

**Визуал**:
- banner_image
- is_featured (на главной)
- is_active

---

## 4. СТРУКТУРА САЙТА И МАКЕТЫ

### 4.1 Список страниц (MVP)

**Обязательные**:
1. Главная (`/`)
2. Каталог (`/catalog`)
3. Карточка товара (`/product/[slug]`)
4. Корзина (`/cart`)
5. Оформление заказа (`/checkout`)
6. Личный кабинет (`/account`)
7. Избранное (`/wishlist`)
8. Акции и распродажи (`/promotions`)
9. Статические: О компании, Доставка, Гарантии, Контакты, Политика конфиденциальности, Пользовательское соглашение

### 4.2 Header (sticky)

```
┌────────────────────────────────────────────────────────────┐
│ [Логотип] | Каталог | О нас | Акции | Контакты | YouTube  │
│                                          [🔍] [❤️(3)] [🛒(2)]│
└────────────────────────────────────────────────────────────┘
```

**Элементы**:
- Логотип (кликабелен → главная)
- Навигационное меню
- Поиск (иконка, раскрывается в input)
- Избранное (иконка сердца + счетчик)
- Корзина (иконка + счетчик)

**Требования**:
- Sticky позиция при скролле
- Мобильная версия: бургер-меню
- Z-index: 50

### 4.3 Hero-слайдер (fullscreen)

```
┌────────────────────────────────────────────────────────────┐
│                                                             │
│  [◄]            Полноэкранное фото товара            [►]   │
│                  (с затемнением 30%)                        │
│                                                             │
│  ┌─────────────────────────┐                               │
│  │ Охотничий нож "Медведь" │     ← Карточка с инфо        │
│  │ Сталь: AUS-8            │       (левый нижний угол)     │
│  │ Длина: 240 мм           │                               │
│  │ ₽ 12 990                │                               │
│  │ [Смотреть товар →]      │                               │
│  └─────────────────────────┘                               │
│                                                             │
│           ━━━━  ━━━━  ━━━━  ━━━━  ← Линейные индикаторы  │
└────────────────────────────────────────────────────────────┘
```

**Требования**:
- Изображения: полноэкранные (1920x1080 минимум), WebP формат
- Количество слайдов: 3-5 товаров
- Автопрокрутка: каждые 5 секунд, останавливается при взаимодействии
- Навигация: стрелки по бокам + линейные индикаторы внизу (НЕ точки!)
- Карточка товара:
  - Фон: `bg-white/95 backdrop-blur-sm`
  - Padding: 32px
  - Закругленные углы: 8px
  - Тень: `shadow-2xl`
  - Содержимое: название (h2, 3xl, bold), 2-3 характеристики, цена (3xl, bold), кнопка CTA (красная, `bg-red-600`)

**Источник товаров**: Product.is_featured = True

### 4.4 Секция "Новинки"

```
┌────────────────────────────────────────────────────────────┐
│                        Новинки                              │
│                                                             │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  │
│  │  [Фото]  │  │  [Фото]  │  │  [Фото]  │  │  [Фото]  │  │
│  │  300x300 │  │  300x300 │  │  300x300 │  │  300x300 │  │
│  │          │  │          │  │          │  │          │  │
│  │ Название │  │ Название │  │ Название │  │ Название │  │
│  │ ₽ 7 990  │  │ ₽ 5 490  │  │ ₽ 12 990 │  │ ₽ 8 990  │  │
│  │ [🛒]     │  │ [🛒]     │  │ [🛒]     │  │ [🛒]     │  │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘  │
│                                                             │
│  ┌──────────┐  ┌──────────┐                                │
│  │  ...     │  │  ...     │                                │
│  └──────────┘  └──────────┘                                │
│                                                             │
│              [Смотреть весь каталог →]                     │
└────────────────────────────────────────────────────────────┘
```

**Требования**:
- Количество: 4-6 товаров
- Источник: Product.is_new = True, сортировка по дате создания
- Grid: 4 колонки (desktop), 2 колонки (tablet), 1 колонка (mobile)
- Gap: 24px
- Кнопка внизу: ссылка на каталог с иконкой стрелки

### 4.5 Секция "Популярные категории"

```
┌────────────────────────────────────────────────────────────┐
│              Популярные категории                           │
│                                                             │
│  ┌─────────────────┐  ┌─────────────────┐  ┌────────────┐ │
│  │    [Иконка]     │  │    [Иконка]     │  │  [Иконка]  │ │
│  │      🔪         │  │      🪓         │  │    ⚔️      │ │
│  │                 │  │                 │  │            │ │
│  │     Ножи        │  │     Топоры      │  │   Мачете   │ │
│  │   42 товара     │  │   18 товаров    │  │ 8 товаров  │ │
│  └─────────────────┘  └─────────────────┘  └────────────┘ │
└────────────────────────────────────────────────────────────┘
```

**Требования**:
- Количество: 3-4 категории
- Источник: основные категории без подкатегорий
- Дизайн блока:
  - Фон: белый (`bg-white`)
  - Padding: 32px
  - Закругленные углы: 8px
  - Тень: `shadow-sm`, hover: `shadow-md`
  - Иконка: 64px, по центру
  - Название: 20px, semibold
  - Счетчик: 14px, серый
- Hover: название меняет цвет на красный
- Клик: переход в каталог с фильтром по категории

### 4.6 Секция "Преимущества"

```
┌────────────────────────────────────────────────────────────┐
│                  Почему выбирают нас                        │
│                                                             │
│     [📦]              [✓]              [🛡️]                │
│  Доставка          Гарантия         Качество               │
│  по всей РФ        12 месяцев       Ручная работа          │
│  Быстрая и         Полная           Каждое изделие         │
│  надежная          гарантия         создается мастерами    │
└────────────────────────────────────────────────────────────┘
```

**Требования**:
- Количество блоков: 3
- Иконки: lucide-react (Truck, Shield, Award)
- Размер иконок: 64px в круге с фоном `bg-red-100`
- Текст: заголовок 20px semibold, описание 16px серый
- Выравнивание: по центру

### 4.7 Footer

```
┌────────────────────────────────────────────────────────────┐
│  [Логотип]                                                  │
│                                                             │
│  О компании     Покупателям      Контакты                  │
│  - О нас        - Доставка       📧 info@shop.ru           │
│  - Гарантии     - Оплата         📱 +7 (999) 123-45-67     │
│                 - Возврат        📍 Москва, ул. ...        │
│                                                             │
│  Мы в соцсетях: [YouTube] [VK] [Telegram]                  │
│                                                             │
│  © 2025 Мастерская ножей | Политика конфиденциальности    │
└────────────────────────────────────────────────────────────┘
```

**Требования**:
- Фон: темный (`bg-gray-900`)
- Текст: белый/серый
- Ссылки: с hover эффектом
- Responsive: колонки друг под другом на mobile

---

## 5. КАТАЛОГ ТОВАРОВ

### 5.1 Структура страницы

```
┌─────────────┬──────────────────────────────────────────────┐
│             │  [Сортировка ▼]  [Grid/List]  🔍 Поиск      │
│  Фильтры    ├──────────────────────────────────────────────┤
│  (Sidebar)  │  Показано 24 из 87 товаров                   │
│             ├──────────────────────────────────────────────┤
│ Категории   │  ┌────┬────┬────┬────┐                      │
│ ☐ Ножи      │  │img │img │img │img │                      │
│   ☐ Охот.   │  │    │    │    │    │                      │
│   ☐ Тур.    │  └────┴────┴────┴────┘                      │
│ ☐ Топоры    │  ┌────┬────┬────┬────┐                      │
│             │  │img │img │img │img │                      │
│ Цена        │  │    │    │    │    │                      │
│ [════•════] │  └────┴────┴────┴────┘                      │
│ 1000  50000 │                                              │
│             │  [Загрузить еще ▼]                           │
│ Длина клинка│                                              │
│ [════•════] │                                              │
│ 80    250мм │                                              │
│             │                                              │
│ Материал    │                                              │
│ ☐ VG-10     │                                              │
│ ☐ AUS-8     │                                              │
│ ☐ D2        │                                              │
│             │                                              │
│ [Сбросить]  │                                              │
└─────────────┴──────────────────────────────────────────────┘
```

### 5.2 Фильтры

**Обязательные**:
1. Категории (чекбоксы, древовидная структура)
2. Цена (range slider + мин/макс инпуты)
3. Длина клинка (range slider, мм)
4. Общая длина (range slider, мм)
5. Вес (range slider, г)
6. Материал клинка (чекбоксы)
7. Материал рукояти (чекбоксы)
8. Твердость HRC (range slider)
9. Назначение (туризм, охота, EDC, коллекция)
10. Статус (радио: все / в наличии / под заказ)

**Технические требования**:
- Range sliders из shadcn/ui
- Debounce 300ms
- URL-параметры для всех фильтров
- Пример: `/catalog?category=knives&price_min=5000&price_max=15000&blade_material=vg10`
- Кнопка "Сбросить фильтры"
- Счетчик активных фильтров

**Мобильная версия**:
- Фильтры в Bottom Sheet
- Кнопка "Фильтры" с бейджем
- Кнопки "Применить" и "Сбросить"

### 5.3 Сортировка

**Опции**:
- По популярности (по умолчанию)
- По цене: дешевле → дороже
- По цене: дороже → дешевле
- По новизне (сначала новые)
- По названию (А-Я)

**Требования**:
- Dropdown компонент
- Сохранение в URL: `?sort=price_asc`
- Иконка направления сортировки

### 5.4 Grid товаров

- Desktop: 4 колонки
- Tablet: 3 колонки
- Mobile: 2 колонки (или 1 в list mode)
- Gap: 24px
- Skeleton loaders при загрузке

### 5.5 Пагинация

**Рекомендация**: Infinite scroll с индикатором загрузки

**Альтернативы**:
- Классическая (страницы 1, 2, 3...)
- Кнопка "Загрузить еще"

---

## 6. КАРТОЧКА ТОВАРА

### 6.1 Макет

```
┌────────────────────────────────────────────────────────────┐
│  Главная > Каталог > Ножи > Охотничий нож "Медведь"       │
├────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────┐  Охотничий нож "Медведь"             │
│  │                 │  ⭐⭐⭐⭐⭐ 4.8 (12 отзывов)            │
│  │   Основное      │                                        │
│  │   фото          │  Артикул: NK-001                       │
│  │   800x600       │  ✓ В наличии                           │
│  │                 │                                        │
│  ├─────────────────┤  ₽ 12 990                              │
│  │ [▢][▢][▢][▢]   │                                        │
│  └─────────────────┘  [Добавить в корзину]  [❤️ В избранное]│
│      Thumbnails       [Купить в 1 клик]                     │
│                                                             │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│                                                             │
│  Характеристики:                                           │
│  ┌─────────────────────────────────────────────────────┐  │
│  │ Длина клинка      │ 150 мм                          │  │
│  │ Общая длина       │ 280 мм                          │  │
│  │ Вес               │ 320 г                           │  │
│  │ Материал клинка   │ AUS-8                           │  │
│  │ Твердость         │ 58-60 HRC                       │  │
│  │ Материал рукояти  │ Карельская береза               │  │
│  │ Назначение        │ Охота, туризм                   │  │
│  └─────────────────────────────────────────────────────┘  │
│                                                             │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│                                                             │
│  [Табы: Описание | Отзывы (12) | Доставка]                │
│                                                             │
│  [Активная вкладка с контентом]                            │
│                                                             │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│                                                             │
│  Похожие товары                                            │
│  [Слайдер с 4-6 товарами]                                  │
└────────────────────────────────────────────────────────────┘
```

### 6.2 Галерея изображений

**Требования**:
- Основное фото: 800x600px (aspect ratio 4:3)
- Thumbnails: 100x75px, до 8 штук
- Lightbox при клике (полноэкранная галерея)
- Навигация: клик по thumbnail, стрелки, свайп на мобильных
- Zoom при hover (опционально)
- Библиотека: `yet-another-react-lightbox`

### 6.3 Блок информации

**Элементы**:
1. Название (h1, 2.5rem, bold)
2. Рейтинг (звезды + средний балл + количество отзывов)
3. Артикул (серый, мелкий текст)
4. Статус наличия:
   - ✓ В наличии (зеленый)
   - ⏱ Под заказ (синий + срок изготовления)
   - ✗ Нет в наличии (серый)
5. Цена (3rem, bold, красный если скидка)
   - При скидке: зачеркнутая старая цена + процент скидки в бейдже
6. Кнопки:
   - "Добавить в корзину" (большая, красная)
   - "Купить в 1 клик" (второстепенная, белая с обводкой)
   - "В избранное" (иконка сердца)

### 6.4 Таблица характеристик

**Формат**: Две колонки (название | значение)

**Обязательные**:
- Длина клинка (мм)
- Общая длина (мм)
- Вес (г)
- Толщина клинка (мм)
- Материал клинка
- Твердость (HRC)
- Материал рукояти
- Назначение
- Тип заточки
- Наличие ножен (да/нет, материал)

**Дополнительные** (из JSONB `specifications`):
- Форма клинка
- Тип замка (для складных)
- Производитель
- Страна

### 6.5 Табы

**Вкладка "Описание"**:
- Rich text (HTML)
- Форматирование: bold, italic, списки, заголовки
- Изображения (опционально)
- Видео YouTube embed (опционально)

**Вкладка "Отзывы"**:
- См. раздел 7

**Вкладка "Доставка"**:
- Информация о способах доставки
- Сроки
- Стоимость
- Условия возврата

### 6.6 Похожие товары

**Логика подбора**:
1. Та же категория
2. Близкий ценовой диапазон (±30%)
3. Исключить текущий товар
4. Лимит: 6 штук

**UI**: Swiper слайдер с карточками товаров

---

## 7. СИСТЕМА ОТЗЫВОВ

### 7.1 UI отзывов

**Блок с общей информацией**:

```
┌────────────────────┬──────────────────────────────────────┐
│                    │                                      │
│       4.8          │  5 ★  ████████████████████  (8)     │
│   ⭐⭐⭐⭐⭐        │  4 ★  ██████████░░░░░░░░░  (3)     │
│                    │  3 ★  ██░░░░░░░░░░░░░░░░  (1)     │
│   12 отзывов       │  2 ★  ░░░░░░░░░░░░░░░░░░  (0)     │
│                    │  1 ★  ░░░░░░░░░░░░░░░░░░  (0)     │
└────────────────────┴──────────────────────────────────────┘

[Написать отзыв]
```

**Карточка отзыва**:

```
┌────────────────────────────────────────────────────────────┐
│  Иван П.  ✓ Проверенная покупка      ⭐⭐⭐⭐⭐  15.01.2025│
├────────────────────────────────────────────────────────────┤
│  Отличный нож для охоты                                    │
│                                                             │
│  Купил этот нож месяц назад, использовал в походе.        │
│  Очень доволен качеством изготовления и балансом...       │
│                                                             │
│  ┌──────────────────┐  ┌──────────────────┐               │
│  │ ✅ Достоинства   │  │ ❌ Недостатки    │               │
│  │ • Острая заточка │  │ • Тяжеловат      │               │
│  │ • Удобная рукоять│  │                  │               │
│  └──────────────────┘  └──────────────────┘               │
│                                                             │
│  [📷] [📷] [📷]  ← Фото от покупателя                     │
│                                                             │
│  👍 Полезно (5)  |  Ответить                              │
└────────────────────────────────────────────────────────────┘
```

### 7.2 Функционал отзывов

**Требования**:
- Сортировка: по дате / по полезности / по рейтингу
- Фильтр по звездам (5★, 4★, 3★ и ниже)
- До 5 фото на отзыв
- Модерация через Django Admin (is_approved)
- Бейдж "Проверенная покупка" если user купил товар
- Кнопка "Полезно" (один раз от пользователя, учет в ReviewHelpful)

### 7.3 Форма добавления отзыва

**Поля**:
- Оценка (5 звезд, обязательно)
- Заголовок (max 200 символов, обязательно)
- Текст отзыва (max 2000 символов, обязательно)
- Достоинства (опционально)
- Недостатки (опционально)
- Фото (до 5 штук, опционально)

**Валидация**:
- Только для авторизованных
- Один пользователь = один отзыв на товар
- Минимальная длина текста: 50 символов

**UI**:
- Модальное окно или отдельная страница
- Превью загруженных фото
- Счетчик символов
- Кнопка "Отправить на модерацию"

---

## 8. КОРЗИНА И ОФОРМЛЕНИЕ ЗАКАЗА

### 8.1 Корзина

```
┌────────────────────────────────────────────────────────────┐
│  Корзина (3 товара)                        [Очистить корзину]│
├────────────────────────────────────────────────────────────┤
│                                                             │
│  ═══════════════ В НАЛИЧИИ (2 товара) ════════════════════ │
│                                                             │
│  [img] Нож "Медведь"              [- 1 +]    ₽ 12 990  [✕]│
│        Сталь: AUS-8                                         │
│        Резерв до: 15:42:30                                  │
│                                                             │
│  [img] Топор "Викинг"             [- 1 +]    ₽ 8 500   [✕]│
│        Вес: 1200г                                           │
│                                                             │
│  ═══════════════ ПОД ЗАКАЗ (1 товар) ══════════════════════│
│                                                             │
│  [img] Мачете "Джунгли"           [- 1 +]    ₽ 15 000  [✕]│
│        Срок изготовления: 14-21 день                        │
│        Предоплата: ₽ 5 000 (33%)                            │
│                                                             │
├────────────────────────────────────────────────────────────┤
│                                                             │
│  Промокод: [___________] [Применить]                       │
│                                                             │
│  Итого (В наличии):              ₽ 21 490                  │
│  Итого (Под заказ):              ₽ 15 000                  │
│  Предоплата (Под заказ):         ₽ 5 000                   │
│  ─────────────────────────────────────────                 │
│  К оплате сейчас:                ₽ 26 490                  │
│                                                             │
│                              [Оформить заказ →]            │
└────────────────────────────────────────────────────────────┘
```

**Функционал**:
1. Разделение: "В наличии" / "Под заказ"
2. Управление количеством: кнопки +/- и input
3. Резервирование:
   - Таймер обратного отсчета (24-72 часа, настраивается)
   - При истечении → товар удаляется
   - Уведомление за 1 час до окончания
4. Промокод:
   - Поле ввода + кнопка "Применить"
   - Валидация на backend
   - Отображение скидки
5. Итоговый расчет:
   - Отдельные суммы для "В наличии" и "Под заказ"
   - Для "Под заказ": предоплата (настраивается, 30-50%)
   - Финальная сумма к оплате

**Хранение корзины**:
- Авторизованные: в базе данных (Cart model)
- Гости: в localStorage (до 7 дней)

### 8.2 Оформление заказа (Checkout)

**Шаг 1: Контактные данные**

```
┌────────────────────────────────────────────────────────────┐
│  1. Контактные данные                                       │
├────────────────────────────────────────────────────────────┤
│  Имя: [_____________________]                              │
│  Телефон: [_____________________]                          │
│  Email: [_____________________]                            │
│                                                             │
│  ☐ Зарегистрироваться (создать аккаунт после заказа)      │
└────────────────────────────────────────────────────────────┘
```

**Шаг 2: Доставка**

```
┌────────────────────────────────────────────────────────────┐
│  2. Доставка                                                │
├────────────────────────────────────────────────────────────┤
│  Способ доставки:                                          │
│  ○ Курьером по Москве (₽ 500, 1-2 дня)                    │
│  ○ СДЭК до пункта выдачи (₽ 350, 3-5 дней)                │
│  ○ Почта России (₽ 400, 7-14 дней)                        │
│  ○ Самовывоз (бесплатно, адрес: ул. Примерная, 1)         │
│                                                             │
│  Адрес доставки:                                           │
│  Индекс: [______]                                          │
│  Город: [_____________________]                            │
│  Улица: [_____________________]                            │
│  Дом: [___] Корпус: [___] Кв: [___]                       │
│                                                             │
│  Комментарий: [________________________________]           │
└────────────────────────────────────────────────────────────┘
```

**Шаг 3: Оплата**

```
┌────────────────────────────────────────────────────────────┐
│  3. Оплата                                                  │
├────────────────────────────────────────────────────────────┤
│  Способ оплаты:                                            │
│  ○ Онлайн (картой, СБП) через ЮKassa                      │
│  ○ При получении (наличными или картой курьеру)           │
│                                                             │
│  ☐ Согласен с условиями пользовательского соглашения      │
│  ☐ Согласен на обработку персональных данных              │
└────────────────────────────────────────────────────────────┘
```

**Шаг 4: Подтверждение**

```
┌────────────────────────────────────────────────────────────┐
│  4. Подтверждение заказа                                    │
├────────────────────────────────────────────────────────────┤
│  Ваш заказ:                                                │
│  • Нож "Медведь" x1            ₽ 12 990                    │
│  • Топор "Викинг" x1           ₽ 8 500                     │
│                                                             │
│  Доставка: Курьер по Москве    ₽ 500                       │
│  Скидка (промокод NEW10):      -₽ 2 149                    │
│  ─────────────────────────────────────                     │
│  Итого:                        ₽ 19 841                    │
│                                                             │
│  Получатель: Иван Иванов                                   │
│  Телефон: +7 (999) 123-45-67                               │
│  Адрес: 101000, Москва, ул. Примерная, д.1, кв.10         │
│                                                             │
│              [← Назад]  [Оформить заказ →]                 │
└────────────────────────────────────────────────────────────┘
```

**После оформления**:
1. Если оплата онлайн → редирект на ЮKassa
2. После оплаты → страница "Спасибо за заказ"
3. Email с подтверждением и номером заказа
4. SMS с номером заказа (опционально)

### 8.3 Страница "Спасибо за заказ"

```
┌────────────────────────────────────────────────────────────┐
│                                                             │
│                    ✓ Заказ оформлен!                       │
│                                                             │
│  Номер вашего заказа: #12345                               │
│  Статус: Оплачен                                           │
│                                                             │
│  Письмо с деталями отправлено на: ivan@example.com        │
│                                                             │
│  Вы можете отслеживать статус заказа в личном кабинете.   │
│                                                             │
│         [Перейти в личный кабинет]  [На главную]          │
└────────────────────────────────────────────────────────────┘
```

---

## 9. ЛИЧНЫЙ КАБИНЕТ

### 9.1 Структура

```
┌─────────────┬──────────────────────────────────────────────┐
│             │                                              │
│  Меню:      │           Личный кабинет                    │
│             │           Иван Иванов                        │
│  • Профиль  │           ivan@example.com                   │
│  • Заказы   ├──────────────────────────────────────────────┤
│  • Избранное│                                              │
│  • Выход    │  [Активная страница]                        │
│             │                                              │
└─────────────┴──────────────────────────────────────────────┘
```

### 9.2 Мои заказы

```
┌────────────────────────────────────────────────────────────┐
│  Мои заказы (12)                [Фильтр по статусу ▼]      │
├────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌──────────────────────────────────────────────────────┐ │
│  │ Заказ #12345                   15.01.2025   ✓ Оплачен│ │
│  ├──────────────────────────────────────────────────────┤ │
│  │ [img] Нож "Медведь" x1                   ₽ 12 990    │ │
│  │ [img] Топор "Викинг" x1                  ₽ 8 500     │ │
│  │                                                       │ │
│  │ Итого: ₽ 21 490                                      │ │
│  │                                                       │ │
│  │ Статус: В обработке                                  │ │
│  │ Трек-номер: 1234567890                               │ │
│  │                                                       │ │
│  │     [Подробнее]  [Повторить заказ]  [Отменить]      │ │
│  └──────────────────────────────────────────────────────┘ │
│                                                             │
│  ┌──────────────────────────────────────────────────────┐ │
│  │ Заказ #12344                   10.01.2025 ⏱ Под заказ│ │
│  │ ...                                                   │ │
│  └──────────────────────────────────────────────────────┘ │
└────────────────────────────────────────────────────────────┘
```

**Статусы заказов**:
- 🕐 Ожидает оплаты (pending)
- ✓ Оплачен (paid)
- 📦 В обработке (processing)
- 🚚 Отправлен (shipped)
- ✅ Доставлен (delivered)
- ⏱ Под заказ (made_to_order)
- ❌ Отменен (cancelled)

**Функционал**:
- Фильтр по статусу
- Поиск по номеру заказа
- Детальная страница заказа
- Кнопка "Повторить заказ" (добавляет товары в корзину)
- Возможность отменить (если pending/processing)

### 9.3 Детальная страница заказа

```
┌────────────────────────────────────────────────────────────┐
│  ← Назад к заказам                                         │
├────────────────────────────────────────────────────────────┤
│  Заказ #12345 от 15.01.2025                               │
│  Статус: 📦 В обработке                                    │
├────────────────────────────────────────────────────────────┤
│                                                             │
│  Товары:                                                   │
│  • Нож "Медведь" x1              ₽ 12 990                  │
│  • Топор "Викинг" x1             ₽ 8 500                   │
│                                                             │
│  Доставка: Курьер по Москве      ₽ 500                     │
│  Скидка:                         -₽ 2 149                  │
│  ───────────────────────────────────────                   │
│  Итого:                          ₽ 19 841                  │
│                                                             │
│  Способ оплаты: Онлайн (карта)                            │
│  ID платежа: 2d8f7g9h-1a2b-3c4d-5e6f-7g8h9i0j1k2l         │
│                                                             │
│  Доставка:                                                 │
│  Адрес: 101000, Москва, ул. Примерная, д.1, кв.10         │
│  Получатель: Иван Иванов                                   │
│  Телефон: +7 (999) 123-45-67                               │
│  Трек-номер: 1234567890 [Отследить →]                     │
│                                                             │
│  История статусов:                                         │
│  • 15.01.2025 14:30 - Заказ создан                        │
│  • 15.01.2025 14:32 - Оплата получена                     │
│  • 15.01.2025 15:00 - Передан в обработку                 │
│  • 16.01.2025 10:00 - Отправлен (трек: 1234567890)        │
│                                                             │
│              [Скачать чек]  [Связаться с поддержкой]      │
└────────────────────────────────────────────────────────────┘
```

### 9.4 Профиль

```
┌────────────────────────────────────────────────────────────┐
│  Профиль                                                    │
├────────────────────────────────────────────────────────────┤
│                                                             │
│  Личные данные:                                            │
│  Имя: [Иван Иванов________________]                        │
│  Email: [ivan@example.com__________] ✓ Подтвержден        │
│  Телефон: [+7 (999) 123-45-67______]                      │
│                                                             │
│                               [Сохранить изменения]        │
│                                                             │
│  Смена пароля:                                             │
│  Текущий пароль: [_______________]                         │
│  Новый пароль: [_______________]                           │
│  Повтор пароля: [_______________]                          │
│                                                             │
│                               [Изменить пароль]            │
│                                                             │
│  Адреса доставки:                                          │
│  ┌────────────────────────────────────────────────────┐   │
│  │ 📍 Москва, ул. Примерная, д.1, кв.10              │   │
│  │    [Редактировать] [Удалить]                       │   │
│  └────────────────────────────────────────────────────┘   │
│  [+ Добавить новый адрес]                                 │
└────────────────────────────────────────────────────────────┘
```

---

## 10. СТРАНИЦА АКЦИЙ

```
┌────────────────────────────────────────────────────────────┐
│  Акции и распродажи                                        │
├────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌──────────────────────────────────────────────────────┐ │
│  │                                                       │ │
│  │        [Баннер акции 1200x400]                       │ │
│  │        РАСПРОДАЖА ЗИМНЕЙ КОЛЛЕКЦИИ                   │ │
│  │        Скидки до 30%                                  │ │
│  │        До 31 января                                   │ │
│  │                                                       │ │
│  │        [Смотреть товары →]                           │ │
│  └──────────────────────────────────────────────────────┘ │
│                                                             │
│  ┌──────────────────────────────────────────────────────┐ │
│  │ 🎁 НОВОГОДНЯЯ АКЦИЯ            До: 31.12.2025 23:59 │ │
│  ├──────────────────────────────────────────────────────┤ │
│  │ Скидка 15% на все топоры по промокоду: NEWYEAR      │ │
│  │                                                       │ │
│  │ Товары в акции:                                      │ │
│  │ [card] [card] [card] [card]                          │ │
│  └──────────────────────────────────────────────────────┘ │
│                                                             │
│  ┌──────────────────────────────────────────────────────┐ │
│  │ 📦 БЕСПЛАТНАЯ ДОСТАВКА         До: 15.01.2025        │ │
│  ├──────────────────────────────────────────────────────┤ │
│  │ При заказе от 15 000 ₽                               │ │
│  │ [Смотреть каталог →]                                 │ │
│  └──────────────────────────────────────────────────────┘ │
└────────────────────────────────────────────────────────────┘
```

**Функционал**:
- Автоматическое применение: если товар в акции, показываются старая и новая цена
- Промокоды: вводятся в корзине, валидируются на backend
- Таймер: обратный отсчет до окончания
- Фильтр: показывать только активные / все
- SEO: отдельные страницы для крупных акций (slug)

---

## 11. ИЗБРАННОЕ

```
┌────────────────────────────────────────────────────────────┐
│  Избранное (5)                       [Очистить избранное]  │
├────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  │
│  │  [Фото]  │  │  [Фото]  │  │  [Фото]  │  │  [Фото]  │  │
│  │ в наличии│  │под заказ │  │   нет    │  │          │  │
│  │ ₽ 12 990 │  │ ₽ 8 500  │  │ ₽ 15 000 │  │          │  │
│  │ [🛒] [✕] │  │ [🛒] [✕] │  │ [✉️] [✕] │  │          │  │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘  │
└────────────────────────────────────────────────────────────┘
```

**Функционал**:
- Grid как в каталоге
- Быстрое добавление в корзину
- Кнопка "Удалить" (✕)
- Если товара нет → кнопка "Уведомить о поступлении" (✉️)

---

## 12. ПОИСК

### 12.1 UI поиска

**В Header**:
- Иконка 🔍
- При клике → раскрывается input
- Поиск при вводе 3+ символов
- Debounce 300ms

**Dropdown с результатами**:

```
┌────────────────────────────────────────────────────────┐
│  Найдено 5 товаров по запросу "охотничий"             │
├────────────────────────────────────────────────────────┤
│  [img] Нож "Охотничий"           ₽ 12 990  ✓ В наличии│
│  [img] Топор "Охотник"           ₽ 8 500   ⏱ Под заказ│
│  [img] Мачете "Джунгли"          ₽ 15 000  ✓ В наличии│
│                                                         │
│              [Показать все результаты →]               │
└────────────────────────────────────────────────────────┘
```

**Страница результатов** (`/search?q=охотничий`):
- Заголовок: "Результаты поиска: охотничий (5 товаров)"
- Grid товаров как в каталоге
- Подсветка совпадений
- Возможность применить фильтры
- Если ничего не найдено → "Попробуйте изменить запрос" + ссылка на каталог

### 12.2 Backend поиска

**Для MVP** (до 100 товаров):
- PostgreSQL Full-Text Search
- Индексация: название (вес A), описание (вес B)
- Конфигурация: russian
- Топ 20 результатов по релевантности

**Для масштаба** (>1000 товаров):
- Elasticsearch + django-elasticsearch-dsl
- Автодополнение
- Fuzzy search (поиск с опечатками)

---

## 13. ИНТЕГРАЦИЯ ЮKASSA

### 13.1 Процесс оплаты

**Шаг 1: Создание платежа**
- Генерация идемпотентного ключа (UUID)
- Создание платежа через API ЮKassa
- Сохранение в базу (Payment model)
- Возврат URL для редиректа

**Шаг 2: Обработка вебхука**
- Проверка IP whitelist ЮKassa
- Проверка подписи запроса
- Обработка событий:
  - payment.succeeded
  - payment.canceled
  - refund.succeeded

**При успешной оплате**:
1. Обновить статус платежа: succeeded
2. Обновить статус заказа: paid
3. Отправить email с подтверждением (Celery)
4. Зарезервировать товар (для "В наличии")

### 13.2 Возвраты

**Процесс**:
1. Создание возврата через API ЮKassa
2. Обновление статуса платежа: refunded
3. Обновление статуса заказа: cancelled
4. Возврат товара в наличие
5. Email-уведомление клиенту

---

## 14. EMAIL УВЕДОМЛЕНИЯ

### 14.1 Типы писем

1. Регистрация (подтверждение email)
2. Восстановление пароля
3. Новый заказ (подтверждение с деталями)
4. Оплата получена (чек + следующие шаги)
5. Заказ отправлен (трек-номер)
6. Заказ доставлен (просьба оставить отзыв)
7. Заказ отменен (информация о возврате)
8. Товар в наличии (из wishlist)
9. Отзыв опубликован

### 14.2 Настройки

- SMTP: Yandex или другой провайдер
- Отправка: через Celery (асинхронно)
- Шаблоны: Django templates с HTML
- Структура: base.html + наследование

---

## 15. АДМИНКА DJANGO

### 15.1 Product Admin

**Список товаров**:
- Thumbnail изображения (50x50px)
- Название, категория, цена
- Цветной бейдж статуса наличия
- Флаги is_featured, is_new
- Счетчик просмотров
- Дата создания

**Фильтры**:
- stock_status, category, is_featured, is_new, created_at

**Поиск**:
- name, description, blade_material

**Действия**:
- "Добавить в слайдер на главной"
- "Отметить как 'В наличии'"

**Inline**:
- ProductImage (добавление/удаление фото)

### 15.2 Order Admin

**Список заказов**:
- ID, имя, email, телефон
- Сумма
- Цветной бейдж статуса
- Статус платежа
- Дата

**Фильтры**:
- status, created_at, delivery_method

**Поиск**:
- ID, email, phone, name

**Детали**:
- Информация о клиенте
- Адрес и способ доставки
- Список товаров (inline)
- Ссылка на платеж в ЮKassa
- История статусов

**Действия**:
- "Отметить как отправленные" (с отправкой email)
- Экспорт в Excel

---

## 16. API ENDPOINTS

### 16.1 Товары
- `GET /api/products/` - список с фильтрацией
- `GET /api/products/{id}/` - детали
- `GET /api/products/featured/` - для слайдера
- `GET /api/products/new/` - новинки
- `GET /api/products/{id}/similar/` - похожие

### 16.2 Категории
- `GET /api/categories/` - список

### 16.3 Корзина
- `POST /api/cart/add/` - добавить товар
- `PATCH /api/cart/item/{id}/` - изменить количество
- `DELETE /api/cart/item/{id}/` - удалить
- `POST /api/cart/apply-promo/` - промокод
- `GET /api/cart/` - получить корзину

### 16.4 Заказы
- `POST /api/orders/` - создать
- `GET /api/orders/` - список пользователя
- `GET /api/orders/{id}/` - детали

### 16.5 Избранное
- `POST /api/wishlist/` - добавить
- `DELETE /api/wishlist/{id}/` - удалить
- `GET /api/wishlist/` - список

### 16.6 Отзывы
- `POST /api/reviews/` - добавить
- `GET /api/reviews/?product={id}` - отзывы на товар
- `POST /api/reviews/{id}/helpful/` - отметить полезным

### 16.7 Вебхуки
- `POST /api/webhooks/yukassa/` - обработка от ЮKassa

### 16.8 Пагинация и фильтрация
- Пагинация: 24 товара на страницу
- Фильтры: django-filter
- Поиск: SearchFilter по name, description
- Сортировка: price, created_at, views_count

---

## 17. БЕЗОПАСНОСТЬ

### 17.1 Django Settings
- HTTPS: SECURE_SSL_REDIRECT = True
- Cookies: SESSION_COOKIE_SECURE, CSRF_COOKIE_SECURE = True
- HSTS: 31536000 секунд с includeSubDomains
- Headers: X-Frame-Options, X-Content-Type-Options, XSS-Protection
- CORS: настроенные CORS_ALLOWED_ORIGINS
- CSRF: настроенные CSRF_TRUSTED_ORIGINS

### 17.2 Rate Limiting
- API: 10 запросов/секунду (burst 20)
- General: 50 запросов/секунду (burst 100)

### 17.3 Валидация
- Номер телефона (российский формат)
- Email (RFC-compliant)
- Сумма заказа (соответствие товарам)
- SQL injection защита (ORM)
- XSS защита (автоэкранирование, bleach для rich text)

---

## 18. ПРОИЗВОДИТЕЛЬНОСТЬ

### 18.1 Оптимизация запросов
- select_related() для ForeignKey
- prefetch_related() для Many-to-Many
- Database индексы
- Compound индексы для фильтров

### 18.2 Кэширование
- Redis для кэша Django
- @cache_page декоратор
- cache.get/set для дорогих запросов
- TTL: 15 мин для списка, 1 час для featured

### 18.3 Frontend
- Next.js Image optimization (WebP, AVIF)
- Static optimization
- Lazy loading
- Skeleton loaders
- Debounce для фильтров

---

## 19. SEO

### 19.1 Next.js Metadata
- Dynamic title и description
- OpenGraph теги
- Structured Data (Schema.org)
- Robots meta tags

### 19.2 Sitemap и robots.txt
- Автогенерация sitemap.xml
- Приоритеты страниц (1.0 главная, 0.9 каталог, 0.8 товары)
- Частота обновления (daily, weekly)
- robots.txt с разрешениями

### 19.3 URL-структура
- Человекочитаемые slug'и
- Фильтры в URL-параметрах
- Canonical URLs
- Хлебные крошки

---

## 20. МОНИТОРИНГ И ЛОГИРОВАНИЕ

### 20.1 Логирование
- Structured JSON logs
- Ротация файлов (10MB, 5 файлов)
- Уровни по модулям
- Отдельные логи для payments, orders

### 20.2 Мониторинг
- Опционально: Sentry для ошибок
- Email для критичных ошибок
- Dashboard с метриками (опционально)

### 20.3 Метрики
- Время ответа API
- Количество запросов
- Статусы ответов
- Custom middleware

---

## 21. ТЕСТИРОВАНИЕ

### 21.1 Backend
- Unit тесты для моделей
- API тесты для endpoints
- Integration тесты для заказов
- Coverage: 80%+

### 21.2 Frontend
- E2E тесты с Playwright
- Критичные флоу: checkout, корзина
- Разные устройства

### 21.3 Ручное
- Чек-лист перед деплоем
- Тестовые платежи в sandbox
- Email уведомления
- Кроссбраузерность

---

## 22. ЧЕКЛИСТ ЗАПУСКА

### 22.1 Перед деплоем

**Backend**:
- [ ] DEBUG = False
- [ ] ALLOWED_HOSTS настроен
- [ ] SECRET_KEY уникальный
- [ ] Миграции применены
- [ ] Статика собрана
- [ ] Superuser создан
- [ ] Тестовые данные удалены

**Frontend**:
- [ ] NEXT_PUBLIC_API_URL на prod
- [ ] Build без ошибок
- [ ] Env переменные настроены

**Инфраструктура**:
- [ ] SSL установлен
- [ ] Nginx проверен
- [ ] Docker containers запускаются
- [ ] Backup настроен
- [ ] Логи ротируются

**Безопасность**:
- [ ] Firewall (80, 443)
- [ ] SSH по ключу
- [ ] Пароли сложные
- [ ] Rate limiting работает
- [ ] HTTPS редирект

**Интеграции**:
- [ ] ЮKassa production
- [ ] Email SMTP
- [ ] Вебхуки зарегистрированы
- [ ] MinIO настроен

### 22.2 После деплоя
- [ ] Тестовый заказ
- [ ] Проверка оплаты
- [ ] Email уведомления
- [ ] Вебхуки ЮKassa
- [ ] Товары добавлены
- [ ] Поиск работает
- [ ] Фильтры работают
- [ ] Мобильная версия
- [ ] PageSpeed проверен
- [ ] Аналитика настроена

---

## 23. ОЦЕНКА ВРЕМЕНИ (SOLO DEV)

### Фаза 1: Базовая структура (1-2 недели)
- Настройка Django
- Модели: Product, Category, ProductImage
- Django Admin
- API endpoints для товаров
- Next.js проект
- Layout (Header, Footer)
- Главная (без слайдера)
- Каталог (без фильтров)
- Карточка товара

### Фаза 2: Функционал покупки (1-2 недели)
- Модели: Cart, CartItem
- Корзина (API + UI)
- Модели: Order, OrderItem
- Оформление заказа
- Интеграция ЮKassa
- Вебхуки
- Email уведомления
- Личный кабинет

### Фаза 3: Дополнительный функционал (1 неделя)
- Фильтры в каталоге
- Поиск
- Избранное
- Hero-слайдер
- Система отзывов
- Страница акций
- Статические страницы

### Фаза 4: Deployment и оптимизация (1 неделя)
- Docker Compose
- Nginx
- SSL
- Мониторинг
- Бэкапы
- Нагрузочное тестирование
- Оптимизация запросов
- Кэширование

**Итого MVP: 4-6 недель**

---

## 24. ДАЛЬНЕЙШЕЕ РАЗВИТИЕ

### Фаза 2 (после MVP)
- Telegram-бот для уведомлений
- Улучшенная система отзывов
- Программа лояльности
- Сравнение товаров
- Рекомендации на основе истории
- Real-time статус на складе

### Фаза 3 (масштабирование)
- Elasticsearch для поиска
- CDN для статики
- Микросервисы (при необходимости)
- Интеграция с 1C
- Мобильное приложение
- Мультиязычность

---

## 25. ВАЖНЫЕ ЗАМЕЧАНИЯ

### 25.1 Архитектурные решения

**Резервирование товаров**:
- Только для "В наличии"
- Таймер 24-72 часа (настраивается)
- Автоматическое освобождение при истечении
- Уведомление за 1 час

**Предоплата для "Под заказ"**:
- Процент настраивается в админке (30-50%)
- Отдельный платеж для предоплаты
- Оставшаяся сумма - при готовности товара

**Промокоды**:
- Одновременно может быть активен только один
- Проверка на минимальную сумму заказа
- Проверка на применимость к товарам/категориям
- Проверка срока действия

### 25.2 Обработка ошибок

**API ошибки**:
- 400: Некорректные данные
- 401: Не авторизован
- 403: Нет доступа
- 404: Не найдено
- 429: Превышен лимит запросов
- 500: Внутренняя ошибка сервера

**UI уведомления**:
- Toast для успешных действий
- Alert для ошибок
- Подтверждение для критичных действий (удаление)

### 25.3 Производительность базы

**Критичные индексы**:
- Product: (category, stock_status)
- Product: (price, stock_status)
- Product: created_at
- Order: (user, created_at)
- Order: status
- Review: (product, is_approved)

### 25.4 Хранение файлов

**MinIO структура**:
- Bucket: products (изображения товаров)
- Bucket: reviews (фото от покупателей)
- Bucket: promotions (баннеры акций)
- Bucket: static (иконки, логотипы)

**Требования к изображениям**:
- Формат: WebP (основной), JPEG (fallback)
- Товары: оригинал + 3 размера (800x600, 400x300, 100x75)
- Отзывы: оригинал + thumbnail 200x200
- Оптимизация: quality 85%

---

## ЗАКЛЮЧЕНИЕ

Документ содержит полную информацию для разработки интернет-магазина ножей и топоров.

### Ключевые особенности проекта:
✅ Монолитная архитектура для solo-разработчика
✅ Масштабируемость до 1000+ товаров
✅ Полная безопасность (HTTPS, CSRF, XSS, Rate limiting)
✅ Production-ready инфраструктура
✅ Детальные визуальные макеты всех страниц
✅ Продуманная система резервирования и предоплаты
✅ Интеграция с ЮKassa для платежей

### Рекомендуемый порядок реализации:
1. Настроить Docker инфраструктуру
2. Создать базовые модели Django
3. Реализовать каталог (API + UI)
4. Добавить корзину и заказы
5. Интегрировать платежи
6. Добавить дополнительный функционал
7. Оптимизировать и задеплоить

**Оценка времени**: 4-6 недель для MVP

---

*Версия документа: 2.0*  
*Дата: 2025-01-06*